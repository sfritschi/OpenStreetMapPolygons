# Download von administrativen Grenzen und Polygonen aus OpenStreetMap

Alex Eugster, 26.1.2016

## Einleitung
Diese Dokumentation zeigt die vier grundsätzlichen Wege auf, wie man beliebige Polygone/ administrative Grenzen aus OpenStreetMap (OSM) herausbekommt. Damit die Methoden relativ einheitlich sind, versuchen wir die Gemeindegrenzen aus OSM herauszulesen.

[Notizen SK: 1. Sprache anpassen, dass es „seriöser“ wirkt. 2. Kapitel umordnen: Direkte Downloads zuerst, dann Webseiten, dann mit Tools die zuerst zu installieren sind… 3. Ergänzen: es fehlen noch Mapzen's countries… siehe: https://giswiki.hsr.ch/HowTo_OpenStreetMap#Administrative_Grenzen_aus_OSM_aufbereiten_.28getting_administrative_boundaries_from_OSM.29 ]


## Overpass Befehl

Overpass-turbo.osm.ch ist eine Webseite die es uns erlaubt über eine Querry Abfrage direkt Daten herunterzuladen.
Damit auch Nicht-Informatiker solche Abfragen ausführen können, bietet die Webseite einen Wizard an, auf welchem man nach einem sogenannten „Tagnode“ suchen kann.

 Diesen Tagnode lässt sich einfach in openstreetmap.org/ im Bearbeitungsmodus ermitteln. Einfach den gewünschten Node auswählen und schon erscheint eine Infobox mit den relevanten Infos. 



Wir sehen also, Osm benennt Gemeindegrenzen „Administrative Grenzen“ Wir hier auch die relevanten TagInfos, beispielsweise der Name oder die Verwaltungsebene. Für uns ist die Verwaltungsebene wichtig, da eine Gemeindegrenze auch gleichzeitig eine Kantonsgrenze sein könnte. (Bsp: Gemeindegrenze zwischen Hombrechtikon und Rapperswil)
Mit einer kurzen Wiki suche finden wir so auch die Datenbankbegriffe welche OSM verwendet und nach welchen wir dann auch suchen müssen, also „boundary = administrative“ und „admin_level = 8“. 

Unser Query auf Overpass sieht dann folgendermassen aus: 


Die von uns gefilterten Daten lassen sich dann direkt von der Webseite über Export in einem gewünschten Format herunterladen.
(Aufgepasst, bei zu grossen Datenmengen kann der Browser nicht nachkommen und stirbt ab. )

## WambacherOSM Boundaries

Die Webseite osm.wno-edv-service.de/boundaries/ ist für das Herunterladen von Gebietspolygonen sehr gut geeignet. Nach einem einloggen mit dem eigenen OSM Account, kann man das interessante Gebiet auswählen und  exportieren. Von einem Land lassen sich über einen Rechtsklick die sogenannten „children“ selektieren. Die „children“ einfach eine genauere Aufteilung des Landes- oder „parentpolygons“.
Es lassen sich auch ganze Subtrees (Das sind alle children von allen children) herunterladen.

Der Subtree von der Schweiz ist in unserem Fall genau was wir wollen, um die Gemeindegrenzen zu exportieren.



(das lässt uns mit einem .Zip File, welches jeden Bezirk als ein eigenes GeoJson File gespeichert hat.)
Polygons.openstreetmap.fr
Ist eine Seite die die uns die Möglichkeit gibt, einzelne Polygone von OSM herunterzuladen. Dazu benötigen wir die sogenannte „Id of relation“ von unserem Polygon. Es gibt verschiedene Wege, diese ID zu ermitteln. Der einfachste ist meiner Meinung über openstreetmap.org.

Indem man nach einem Polygon sucht z.B. nach der Schweiz Zeigt sich auf der linken Infoseite neben dem Titel des gesuchten Begriffes eine Nummer. Dies ist die ID nach welcher wir suchen. (51701)



Die Seite gibt uns dann verschiedene Möglichkeiten um aus  dieses Polygon herunterzuladen.

Für unser Problem mit den Gemeindegrenzen eignet sich diese Seite nicht besonders, da wir sonst für jede Gemeinde nach der ID suchen müssen und dies ziemlich umständlich ist.
EOSMDBOne
Es ist eine HSR interne Datenbank (genauere Infos unter http://giswiki.hsr.ch/EOSMDBOne).
Über das OGR2OGR Tool lässt sich mit einer Querry Abfrage direkt von EOSMDBOne die gewünschten Daten herunterladen.

Das Erstellen dieses Querrys ist etwas kompliziert, weshalb es sinnvoll ist, diesen zuerst auf der Webseite http://labs.geometa.info/postgisterminal/ auszuprobieren. Diese Seite hat eine Ansicht, auf welcher man den Querry überprüfen kann.



(Querry für alle Gemeinden)


ogr2ogr -f GeoJSON ch_gemeinden.json PG:"host=‘ip' port='' dbname=' user='' password= " -sql "SELECT * FROM osm_polygon WHERE tags @> hstore('admin_level', '8')" -s_srs EPSG:3857 -t_srs EPSG:4326
(Aus Sicherheitsgründen sind die DB-Verbindungsdaten herausgenommen)


Dies ist der Querry mit ogr2ogr verbunden. Wenn man bereits Qgis installiert hat, so ist ein Programm namens „OSGeo4 W Shell“ bereits mit installiert. Darin lassen sich ogr2ogr Befehle ausführen.

Zu beachten ist, dass wir am Ende der Abfrage noch eine Umwandlung von Daten vornehmen, damit diese richtig dargestellt werden können. In unserem Fall wandeln wir die Daten von GPS-Koordinaten in Mercator-Daten um, damit wir damit einfacher rechnen können.

Wenn man Hilfe zu den OGR2OGR Querrys braucht, so kann man sich gut auf der Seite http://giswiki.hsr.ch/HowTo_OGR2OGR Hilfe suchen. Viele Query Probleme sind da bereits gelöst und gut umschrieben.


## Fazit
### Overpass
Overpass konnte leider nicht alle Daten extrahieren, da Chrome zu schwach ist, um die ganze Datenmenge zu verarbeiten, schon die halbe Schweiz hat die Webseite überlastet.
Sie erlaubt es uns jedoch unsere Query-Resultate zu inspizieren. Grundsätzlich macht die Webseite eine gute Arbeit, jedoch ist sie relativ grosszügig, wenn es darum geht Gebiete in der Schweiz auszuwählen. So kommt es, dass auch einige Gemeinden an den Grenzen zur Schweiz, im Lichtenstein und im Tirol miterfasst werden.
Overpass kann wie EOSMDBOne ziemlich viel, ist aber nicht sehr leistungsfähig und die Daten sind nicht so genau wie die anderen Optionen.

### WambacherOSM Boundaries
Wambacher erzeugt uns für jede Gemeinde, für jeden Kanton und für die ganze Schweiz selbst ein Geojson File. Gemeinden sind vollzählig und decken alle Gebiete innerhalb der Schweiz ab. Es werden auch keine Gebiete, welche nicht in der Schweiz liegen markiert. Der einzige Mangel ist, dass die Filenamen für gewisse Gemeinden missraten sind. Anzumerken ist, dass ein einzelnes File, welches alle Gemeinden erfasst hätte einfacher zu verarbeiten gewesen wäre.
Für das Erfassen von Grenzpolygonen ist diese Webseite sehr gut geeignet. Sie ist einfach zu benutzen und liefert perfekte Daten. Für ein Projekt wie das Erfassen von Gemeindegrenzen wäre diese Webseite meine Empfehlung.

### Polygons.openstreetmap.fr
Diese Seite ist für unser Problem leider etwas ungeeignet. Das Problem ist, dass die Webseite uns nur erlaubt einzelne Polygone zu exportieren. Dies ist bei 2.6 Tausend Gemeinden ziemlich mühsam. Die Geometrien sind aber relativ präzise. Um aber die Daten ungefähr prüfen zu können, habe ich mal das Polygon der ganzen Schweiz angeschaut. Die Grenzen sind gut abgeschnitten und es werden weder Teile von Lichtenstein, noch von anderen Nachbarsländer miteinbezogen. Jedoch werden Enklaven zum Polygon dazugezählt. (Ich kann mir vorstellen, dass sich das Problem auf Gemeindeebene aber nicht stellen würde.)
Wenn man die Webseite einmal begriffen hat, ist sie sehr einfach zu bedienen, und sie gibt für kleinere Datenmengen sehr schnell Präzise Daten ab.

### EOSMDBOne
EOSMDBOne erfasst Gemeinden innerhalb der Schweiz auch etwas zu grosszügig. So kommt es, dass Gemeinden an der Grenze ebenfalls als Schweizer Gemeinden erfasst werden. Auch werden Enklaven als Schweizer Gemeinden erfasst.
EOSMDBOne ist von den vier Möglichkeiten die komplizierteste, kann dafür aber neben dem erfassen von Polygonen auch noch einiges mehr.
